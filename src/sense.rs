use std::fmt;
use phf::phf_map;
use std::convert::TryInto;

// SPC-3 Table 28
// Used https://www.t10.org/lists/asc-num.htm (2021-03-25) as reference for
// implementation because the table there is sorted by key values. Should be
// the same info.
//
// Due to the limitations of the phf library, the key cannot be a tuple thus
// it is setup to be (ASC << 8) | (ASCQ)
//
// Note that a few messages match to a range. These are not in this map and
// must be checked else where.
// 0x40NN_u16 => "DIAGNOSTIC FAILURE ON COMPONENT NN (80h-FFh)",
// 0x4DNN_u16 => "TAGGED OVERLAPPED COMMANDS (NN = TASK TAG)",
// 0x70NN_u16 => "DECOMPRESSION EXCEPTION SHORT ALGORITHM ID OF NN",
static ADDITIONAL_SENSE_CODE_STRINGS: phf::Map <u16, &str> = phf_map! {
  0x0000_u16 => "NO ADDITIONAL SENSE INFORMATION",
  0x0001_u16 => "FILEMARK DETECTED",
  0x0002_u16 => "END_OF_PARTITION/MEDIUM DETECTED",
  0x0003_u16 => "SETMARK DETECTED",
  0x0004_u16 => "BEGINNING-OF-PARTITION/MEDIUM DETECTED",
  0x0005_u16 => "END-OF-DATA DETECTED",
  0x0006_u16 => "I/O PROCESS TERMINATED",
  0x0007_u16 => "PROGRAMMABLE EARLY WARNING DETECTED",
  0x0011_u16 => "AUDIO PLAY OPERATION IN PROGRESS",
  0x0012_u16 => "AUDIO PLAY OPERATION PAUSED",
  0x0013_u16 => "AUDIO PLAY OPERATION SUCCESSFULLY COMPLETED",
  0x0014_u16 => "AUDIO PLAY OPERATION STOPPED DUE TO ERROR",
  0x0015_u16 => "NO CURRENT AUDIO STATUS TO RETURN",
  0x0016_u16 => "OPERATION IN PROGRESS",
  0x0017_u16 => "CLEANING REQUESTED",
  0x0018_u16 => "ERASE OPERATION IN PROGRESS",
  0x0019_u16 => "LOCATE OPERATION IN PROGRESS",
  0x001A_u16 => "REWIND OPERATION IN PROGRESS",
  0x001B_u16 => "SET CAPACITY OPERATION IN PROGRESS",
  0x001C_u16 => "VERIFY OPERATION IN PROGRESS",
  0x001D_u16 => "ATA PASS THROUGH INFORMATION AVAILABLE",
  0x001E_u16 => "CONFLICTING SA CREATION REQUEST",
  0x001F_u16 => "LOGICAL UNIT TRANSITIONING TO ANOTHER POWER CONDITION",
  0x0020_u16 => "EXTENDED COPY INFORMATION AVAILABLE",
  0x0021_u16 => "ATOMIC COMMAND ABORTED DUE TO ACA",
  0x0022_u16 => "DEFERRED MICROCODE IS PENDING",
  0x0100_u16 => "NO INDEX/SECTOR SIGNAL",
  0x0200_u16 => "NO SEEK COMPLETE",
  0x0300_u16 => "PERIPHERAL DEVICE WRITE FAULT",
  0x0301_u16 => "NO WRITE CURRENT",
  0x0302_u16 => "EXCESSIVE WRITE ERRORS",
  0x0400_u16 => "LOGICAL UNIT NOT READY, CAUSE NOT REPORTABLE",
  0x0401_u16 => "LOGICAL UNIT IS IN PROCESS OF BECOMING READY",
  0x0402_u16 => "LOGICAL UNIT NOT READY, INITIALIZING COMMAND REQUIRED",
  0x0403_u16 => "LOGICAL UNIT NOT READY, MANUAL INTERVENTION REQUIRED",
  0x0404_u16 => "LOGICAL UNIT NOT READY, FORMAT IN PROGRESS",
  0x0405_u16 => "LOGICAL UNIT NOT READY, REBUILD IN PROGRESS",
  0x0406_u16 => "LOGICAL UNIT NOT READY, RECALCULATION IN PROGRESS",
  0x0407_u16 => "LOGICAL UNIT NOT READY, OPERATION IN PROGRESS",
  0x0408_u16 => "LOGICAL UNIT NOT READY, LONG WRITE IN PROGRESS",
  0x0409_u16 => "LOGICAL UNIT NOT READY, SELF-TEST IN PROGRESS",
  0x040A_u16 => "LOGICAL UNIT NOT ACCESSIBLE, ASYMMETRIC ACCESS STATE TRANSITION",
  0x040B_u16 => "LOGICAL UNIT NOT ACCESSIBLE, TARGET PORT IN STANDBY STATE",
  0x040C_u16 => "LOGICAL UNIT NOT ACCESSIBLE, TARGET PORT IN UNAVAILABLE STATE",
  0x040D_u16 => "LOGICAL UNIT NOT READY, STRUCTURE CHECK REQUIRED",
  0x040E_u16 => "LOGICAL UNIT NOT READY, SECURITY SESSION IN PROGRESS",
  0x0410_u16 => "LOGICAL UNIT NOT READY, AUXILIARY MEMORY NOT ACCESSIBLE",
  0x0411_u16 => "LOGICAL UNIT NOT READY, NOTIFY (ENABLE SPINUP) REQUIRED",
  0x0412_u16 => "LOGICAL UNIT NOT READY, OFFLINE",
  0x0413_u16 => "LOGICAL UNIT NOT READY, SA CREATION IN PROGRESS",
  0x0414_u16 => "LOGICAL UNIT NOT READY, SPACE ALLOCATION IN PROGRESS",
  0x0415_u16 => "LOGICAL UNIT NOT READY, ROBOTICS DISABLED",
  0x0416_u16 => "LOGICAL UNIT NOT READY, CONFIGURATION REQUIRED",
  0x0417_u16 => "LOGICAL UNIT NOT READY, CALIBRATION REQUIRED",
  0x0418_u16 => "LOGICAL UNIT NOT READY, A DOOR IS OPEN",
  0x0419_u16 => "LOGICAL UNIT NOT READY, OPERATING IN SEQUENTIAL MODE",
  0x041A_u16 => "LOGICAL UNIT NOT READY, START STOP UNIT COMMAND IN PROGRESS",
  0x041B_u16 => "LOGICAL UNIT NOT READY, SANITIZE IN PROGRESS",
  0x041C_u16 => "LOGICAL UNIT NOT READY, ADDITIONAL POWER USE NOT YET GRANTED",
  0x041D_u16 => "LOGICAL UNIT NOT READY, CONFIGURATION IN PROGRESS",
  0x041E_u16 => "LOGICAL UNIT NOT READY, MICROCODE ACTIVATION REQUIRED",
  0x041F_u16 => "LOGICAL UNIT NOT READY, MICROCODE DOWNLOAD REQUIRED",
  0x0420_u16 => "LOGICAL UNIT NOT READY, LOGICAL UNIT RESET REQUIRED",
  0x0421_u16 => "LOGICAL UNIT NOT READY, HARD RESET REQUIRED",
  0x0422_u16 => "LOGICAL UNIT NOT READY, POWER CYCLE REQUIRED",
  0x0423_u16 => "LOGICAL UNIT NOT READY, AFFILIATION REQUIRED",
  0x0424_u16 => "DEPOPULATION IN PROGRESS",
  0x0425_u16 => "DEPOPULATION RESTORATION IN PROGRESS",
  0x0500_u16 => "LOGICAL UNIT DOES NOT RESPOND TO SELECTION",
  0x0600_u16 => "NO REFERENCE POSITION FOUND",
  0x0700_u16 => "MULTIPLE PERIPHERAL DEVICES SELECTED",
  0x0800_u16 => "LOGICAL UNIT COMMUNICATION FAILURE",
  0x0801_u16 => "LOGICAL UNIT COMMUNICATION TIME-OUT",
  0x0802_u16 => "LOGICAL UNIT COMMUNICATION PARITY ERROR",
  0x0803_u16 => "LOGICAL UNIT COMMUNICATION CRC ERROR (ULTRA-DMA/32)",
  0x0804_u16 => "UNREACHABLE COPY TARGET",
  0x0900_u16 => "TRACK FOLLOWING ERROR",
  0x0901_u16 => "TRACKING SERVO FAILURE",
  0x0902_u16 => "FOCUS SERVO FAILURE",
  0x0903_u16 => "SPINDLE SERVO FAILURE",
  0x0904_u16 => "HEAD SELECT FAULT",
  0x0905_u16 => "VIBRATION INDUCED TRACKING ERROR",
  0x0A00_u16 => "ERROR LOG OVERFLOW",
  0x0B00_u16 => "WARNING",
  0x0B01_u16 => "WARNING - SPECIFIED TEMPERATURE EXCEEDED",
  0x0B02_u16 => "WARNING - ENCLOSURE DEGRADED",
  0x0B03_u16 => "WARNING - BACKGROUND SELF-TEST FAILED",
  0x0B04_u16 => "WARNING - BACKGROUND PRE-SCAN DETECTED MEDIUM ERROR",
  0x0B05_u16 => "WARNING - BACKGROUND MEDIUM SCAN DETECTED MEDIUM ERROR",
  0x0B06_u16 => "WARNING - NON-VOLATILE CACHE NOW VOLATILE",
  0x0B07_u16 => "WARNING - DEGRADED POWER TO NON-VOLATILE CACHE",
  0x0B08_u16 => "WARNING - POWER LOSS EXPECTED",
  0x0B09_u16 => "WARNING - DEVICE STATISTICS NOTIFICATION ACTIVE",
  0x0B0A_u16 => "WARNING - HIGH CRITICAL TEMPERATURE LIMIT EXCEEDED",
  0x0B0B_u16 => "WARNING - LOW CRITICAL TEMPERATURE LIMIT EXCEEDED",
  0x0B0C_u16 => "WARNING - HIGH OPERATING TEMPERATURE LIMIT EXCEEDED",
  0x0B0D_u16 => "WARNING - LOW OPERATING TEMPERATURE LIMIT EXCEEDED",
  0x0B0E_u16 => "WARNING - HIGH CRITICAL HUMIDITY LIMIT EXCEEDED",
  0x0B0F_u16 => "WARNING - LOW CRITICAL HUMIDITY LIMIT EXCEEDED",
  0x0B10_u16 => "WARNING - HIGH OPERATING HUMIDITY LIMIT EXCEEDED",
  0x0B11_u16 => "WARNING - LOW OPERATING HUMIDITY LIMIT EXCEEDED",
  0x0B12_u16 => "WARNING - MICROCODE SECURITY AT RISK",
  0x0B13_u16 => "WARNING - MICROCODE DIGITAL SIGNATURE VALIDATION FAILURE",
  0x0B14_u16 => "WARNING - PHYSICAL ELEMENT STATUS CHANGE",
  0x0C00_u16 => "WRITE ERROR",
  0x0C01_u16 => "WRITE ERROR - RECOVERED WITH AUTO REALLOCATION",
  0x0C02_u16 => "WRITE ERROR - AUTO REALLOCATION FAILED",
  0x0C03_u16 => "WRITE ERROR - RECOMMEND REASSIGNMENT",
  0x0C04_u16 => "COMPRESSION CHECK MISCOMPARE ERROR",
  0x0C05_u16 => "DATA EXPANSION OCCURRED DURING COMPRESSION",
  0x0C06_u16 => "BLOCK NOT COMPRESSIBLE",
  0x0C07_u16 => "WRITE ERROR - RECOVERY NEEDED",
  0x0C08_u16 => "WRITE ERROR - RECOVERY FAILED",
  0x0C09_u16 => "WRITE ERROR - LOSS OF STREAMING",
  0x0C0A_u16 => "WRITE ERROR - PADDING BLOCKS ADDED",
  0x0C0B_u16 => "AUXILIARY MEMORY WRITE ERROR",
  0x0C0C_u16 => "WRITE ERROR - UNEXPECTED UNSOLICITED DATA",
  0x0C0D_u16 => "WRITE ERROR - NOT ENOUGH UNSOLICITED DATA",
  0x0C0E_u16 => "MULTIPLE WRITE ERRORS",
  0x0C0F_u16 => "DEFECTS IN ERROR WINDOW",
  0x0C10_u16 => "INCOMPLETE MULTIPLE ATOMIC WRITE OPERATIONS",
  0x0C11_u16 => "WRITE ERROR - RECOVERY SCAN NEEDED",
  0x0C12_u16 => "WRITE ERROR - INSUFFICIENT ZONE RESOURCES",
  0x0D00_u16 => "ERROR DETECTED BY THIRD PARTY TEMPORARY INITIATOR",
  0x0D01_u16 => "THIRD PARTY DEVICE FAILURE",
  0x0D02_u16 => "COPY TARGET DEVICE NOT REACHABLE",
  0x0D03_u16 => "INCORRECT COPY TARGET DEVICE TYPE",
  0x0D04_u16 => "COPY TARGET DEVICE DATA UNDERRUN",
  0x0D05_u16 => "COPY TARGET DEVICE DATA OVERRUN",
  0x0E00_u16 => "INVALID INFORMATION UNIT",
  0x0E01_u16 => "INFORMATION UNIT TOO SHORT",
  0x0E02_u16 => "INFORMATION UNIT TOO LONG",
  0x0E03_u16 => "INVALID FIELD IN COMMAND INFORMATION UNIT",
  0x1000_u16 => "ID CRC OR ECC ERROR",
  0x1001_u16 => "LOGICAL BLOCK GUARD CHECK FAILED",
  0x1002_u16 => "LOGICAL BLOCK APPLICATION TAG CHECK FAILED",
  0x1003_u16 => "LOGICAL BLOCK REFERENCE TAG CHECK FAILED",
  0x1004_u16 => "LOGICAL BLOCK PROTECTION ERROR ON RECOVER BUFFERED DATA",
  0x1005_u16 => "LOGICAL BLOCK PROTECTION METHOD ERROR",
  0x1100_u16 => "UNRECOVERED READ ERROR",
  0x1101_u16 => "READ RETRIES EXHAUSTED",
  0x1102_u16 => "ERROR TOO LONG TO CORRECT",
  0x1103_u16 => "MULTIPLE READ ERRORS",
  0x1104_u16 => "UNRECOVERED READ ERROR - AUTO REALLOCATE FAILED",
  0x1105_u16 => "L-EC UNCORRECTABLE ERROR",
  0x1106_u16 => "CIRC UNRECOVERED ERROR",
  0x1107_u16 => "DATA RE-SYNCHRONIZATION ERROR",
  0x1108_u16 => "INCOMPLETE BLOCK READ",
  0x1109_u16 => "NO GAP FOUND",
  0x110A_u16 => "MISCORRECTED ERROR",
  0x110B_u16 => "UNRECOVERED READ ERROR - RECOMMEND REASSIGNMENT",
  0x110C_u16 => "UNRECOVERED READ ERROR - RECOMMEND REWRITE THE DATA",
  0x110D_u16 => "DE-COMPRESSION CRC ERROR",
  0x110E_u16 => "CANNOT DECOMPRESS USING DECLARED ALGORITHM",
  0x110F_u16 => "ERROR READING UPC/EAN NUMBER",
  0x1110_u16 => "ERROR READING ISRC NUMBER",
  0x1111_u16 => "READ ERROR - LOSS OF STREAMING",
  0x1112_u16 => "AUXILIARY MEMORY READ ERROR",
  0x1113_u16 => "READ ERROR - FAILED RETRANSMISSION REQUEST",
  0x1114_u16 => "READ ERROR - LBA MARKED BAD BY APPLICATION CLIENT",
  0x1115_u16 => "WRITE AFTER SANITIZE REQUIRED",
  0x1200_u16 => "ADDRESS MARK NOT FOUND FOR ID FIELD",
  0x1300_u16 => "ADDRESS MARK NOT FOUND FOR DATA FIELD",
  0x1400_u16 => "RECORDED ENTITY NOT FOUND",
  0x1401_u16 => "RECORD NOT FOUND",
  0x1402_u16 => "FILEMARK OR SETMARK NOT FOUND",
  0x1403_u16 => "END-OF-DATA NOT FOUND",
  0x1404_u16 => "BLOCK SEQUENCE ERROR",
  0x1405_u16 => "RECORD NOT FOUND - RECOMMEND REASSIGNMENT",
  0x1406_u16 => "RECORD NOT FOUND - DATA AUTO-REALLOCATED",
  0x1407_u16 => "LOCATE OPERATION FAILURE",
  0x1500_u16 => "RANDOM POSITIONING ERROR",
  0x1501_u16 => "MECHANICAL POSITIONING ERROR",
  0x1502_u16 => "POSITIONING ERROR DETECTED BY READ OF MEDIUM",
  0x1600_u16 => "DATA SYNCHRONIZATION MARK ERROR",
  0x1601_u16 => "DATA SYNC ERROR - DATA REWRITTEN",
  0x1602_u16 => "DATA SYNC ERROR - RECOMMEND REWRITE",
  0x1603_u16 => "DATA SYNC ERROR - DATA AUTO-REALLOCATED",
  0x1604_u16 => "DATA SYNC ERROR - RECOMMEND REASSIGNMENT",
  0x1700_u16 => "RECOVERED DATA WITH NO ERROR CORRECTION APPLIED",
  0x1701_u16 => "RECOVERED DATA WITH RETRIES",
  0x1702_u16 => "RECOVERED DATA WITH POSITIVE HEAD OFFSET",
  0x1703_u16 => "RECOVERED DATA WITH NEGATIVE HEAD OFFSET",
  0x1704_u16 => "RECOVERED DATA WITH RETRIES AND/OR CIRC APPLIED",
  0x1705_u16 => "RECOVERED DATA USING PREVIOUS SECTOR ID",
  0x1706_u16 => "RECOVERED DATA WITHOUT ECC - DATA AUTO-REALLOCATED",
  0x1707_u16 => "RECOVERED DATA WITHOUT ECC - RECOMMEND REASSIGNMENT",
  0x1708_u16 => "RECOVERED DATA WITHOUT ECC - RECOMMEND REWRITE",
  0x1709_u16 => "RECOVERED DATA WITHOUT ECC - DATA REWRITTEN",
  0x1800_u16 => "RECOVERED DATA WITH ERROR CORRECTION APPLIED",
  0x1801_u16 => "RECOVERED DATA WITH ERROR CORR. & RETRIES APPLIED",
  0x1802_u16 => "RECOVERED DATA - DATA AUTO-REALLOCATED",
  0x1803_u16 => "RECOVERED DATA WITH CIRC",
  0x1804_u16 => "RECOVERED DATA WITH L-EC",
  0x1805_u16 => "RECOVERED DATA - RECOMMEND REASSIGNMENT",
  0x1806_u16 => "RECOVERED DATA - RECOMMEND REWRITE",
  0x1807_u16 => "RECOVERED DATA WITH ECC - DATA REWRITTEN",
  0x1808_u16 => "RECOVERED DATA WITH LINKING",
  0x1900_u16 => "DEFECT LIST ERROR",
  0x1901_u16 => "DEFECT LIST NOT AVAILABLE",
  0x1902_u16 => "DEFECT LIST ERROR IN PRIMARY LIST",
  0x1903_u16 => "DEFECT LIST ERROR IN GROWN LIST",
  0x1A00_u16 => "PARAMETER LIST LENGTH ERROR",
  0x1B00_u16 => "SYNCHRONOUS DATA TRANSFER ERROR",
  0x1C00_u16 => "DEFECT LIST NOT FOUND",
  0x1C01_u16 => "PRIMARY DEFECT LIST NOT FOUND",
  0x1C02_u16 => "GROWN DEFECT LIST NOT FOUND",
  0x1D00_u16 => "MISCOMPARE DURING VERIFY OPERATION",
  0x1D01_u16 => "MISCOMPARE VERIFY OF UNMAPPED LBA",
  0x1E00_u16 => "RECOVERED ID WITH ECC CORRECTION",
  0x1F00_u16 => "PARTIAL DEFECT LIST TRANSFER",
  0x2000_u16 => "INVALID COMMAND OPERATION CODE",
  0x2001_u16 => "ACCESS DENIED - INITIATOR PENDING-ENROLLED",
  0x2002_u16 => "ACCESS DENIED - NO ACCESS RIGHTS",
  0x2003_u16 => "ACCESS DENIED - INVALID MGMT ID KEY",
  0x2004_u16 => "ILLEGAL COMMAND WHILE IN WRITE CAPABLE STATE",
  0x2005_u16 => "Obsolete",
  0x2006_u16 => "ILLEGAL COMMAND WHILE IN EXPLICIT ADDRESS MODE",
  0x2007_u16 => "ILLEGAL COMMAND WHILE IN IMPLICIT ADDRESS MODE",
  0x2008_u16 => "ACCESS DENIED - ENROLLMENT CONFLICT",
  0x2009_u16 => "ACCESS DENIED - INVALID LU IDENTIFIER",
  0x200A_u16 => "ACCESS DENIED - INVALID PROXY TOKEN",
  0x200B_u16 => "ACCESS DENIED - ACL LUN CONFLICT",
  0x200C_u16 => "ILLEGAL COMMAND WHEN NOT IN APPEND-ONLY MODE",
  0x200D_u16 => "NOT AN ADMINISTRATIVE LOGICAL UNIT",
  0x200E_u16 => "NOT A SUBSIDIARY LOGICAL UNIT",
  0x200F_u16 => "NOT A CONGLOMERATE LOGICAL UNIT",
  0x2100_u16 => "LOGICAL BLOCK ADDRESS OUT OF RANGE",
  0x2101_u16 => "INVALID ELEMENT ADDRESS",
  0x2102_u16 => "INVALID ADDRESS FOR WRITE",
  0x2103_u16 => "INVALID WRITE CROSSING LAYER JUMP",
  0x2104_u16 => "UNALIGNED WRITE COMMAND",
  0x2105_u16 => "WRITE BOUNDARY VIOLATION",
  0x2106_u16 => "ATTEMPT TO READ INVALID DATA",
  0x2107_u16 => "READ BOUNDARY VIOLATION",
  0x2108_u16 => "MISALIGNED WRITE COMMAND",
  0x2109_u16 => "ATTEMPT TO ACCESS GAP ZONE",
  0x2200_u16 => "ILLEGAL FUNCTION (USE 20 00, 24 00, OR 26 00)",
  0x2300_u16 => "INVALID TOKEN OPERATION, CAUSE NOT REPORTABLE",
  0x2301_u16 => "INVALID TOKEN OPERATION, UNSUPPORTED TOKEN TYPE",
  0x2302_u16 => "INVALID TOKEN OPERATION, REMOTE TOKEN USAGE NOT SUPPORTED",
  0x2303_u16 => "INVALID TOKEN OPERATION, REMOTE ROD TOKEN CREATION NOT SUPPORTED",
  0x2304_u16 => "INVALID TOKEN OPERATION, TOKEN UNKNOWN",
  0x2305_u16 => "INVALID TOKEN OPERATION, TOKEN CORRUPT",
  0x2306_u16 => "INVALID TOKEN OPERATION, TOKEN REVOKED",
  0x2307_u16 => "INVALID TOKEN OPERATION, TOKEN EXPIRED",
  0x2308_u16 => "INVALID TOKEN OPERATION, TOKEN CANCELLED",
  0x2309_u16 => "INVALID TOKEN OPERATION, TOKEN DELETED",
  0x230A_u16 => "INVALID TOKEN OPERATION, INVALID TOKEN LENGTH",
  0x2400_u16 => "INVALID FIELD IN CDB",
  0x2401_u16 => "CDB DECRYPTION ERROR",
  0x2402_u16 => "Obsolete",
  0x2403_u16 => "Obsolete",
  0x2404_u16 => "SECURITY AUDIT VALUE FROZEN",
  0x2405_u16 => "SECURITY WORKING KEY FROZEN",
  0x2406_u16 => "NONCE NOT UNIQUE",
  0x2407_u16 => "NONCE TIMESTAMP OUT OF RANGE",
  0x2408_u16 => "INVALID XCDB",
  0x2409_u16 => "INVALID FAST FORMAT",
  0x2500_u16 => "LOGICAL UNIT NOT SUPPORTED",
  0x2600_u16 => "INVALID FIELD IN PARAMETER LIST",
  0x2601_u16 => "PARAMETER NOT SUPPORTED",
  0x2602_u16 => "PARAMETER VALUE INVALID",
  0x2603_u16 => "THRESHOLD PARAMETERS NOT SUPPORTED",
  0x2604_u16 => "INVALID RELEASE OF PERSISTENT RESERVATION",
  0x2605_u16 => "DATA DECRYPTION ERROR",
  0x2606_u16 => "TOO MANY TARGET DESCRIPTORS",
  0x2607_u16 => "UNSUPPORTED TARGET DESCRIPTOR TYPE CODE",
  0x2608_u16 => "TOO MANY SEGMENT DESCRIPTORS",
  0x2609_u16 => "UNSUPPORTED SEGMENT DESCRIPTOR TYPE CODE",
  0x260A_u16 => "UNEXPECTED INEXACT SEGMENT",
  0x260B_u16 => "INLINE DATA LENGTH EXCEEDED",
  0x260C_u16 => "INVALID OPERATION FOR COPY SOURCE OR DESTINATION",
  0x260D_u16 => "COPY SEGMENT GRANULARITY VIOLATION",
  0x260E_u16 => "INVALID PARAMETER WHILE PORT IS ENABLED",
  0x260F_u16 => "INVALID DATA-OUT BUFFER INTEGRITY CHECK VALUE",
  0x2610_u16 => "DATA DECRYPTION KEY FAIL LIMIT REACHED",
  0x2611_u16 => "INCOMPLETE KEY-ASSOCIATED DATA SET",
  0x2612_u16 => "VENDOR SPECIFIC KEY REFERENCE NOT FOUND",
  0x2613_u16 => "APPLICATION TAG MODE PAGE IS INVALID",
  0x2614_u16 => "TAPE STREAM MIRRORING PREVENTED",
  0x2615_u16 => "COPY SOURCE OR COPY DESTINATION NOT AUTHORIZED",
  0x2616_u16 => "FAST COPY NOT POSSIBLE",
  0x2700_u16 => "WRITE PROTECTED",
  0x2701_u16 => "HARDWARE WRITE PROTECTED",
  0x2702_u16 => "LOGICAL UNIT SOFTWARE WRITE PROTECTED",
  0x2703_u16 => "ASSOCIATED WRITE PROTECT",
  0x2704_u16 => "PERSISTENT WRITE PROTECT",
  0x2705_u16 => "PERMANENT WRITE PROTECT",
  0x2706_u16 => "CONDITIONAL WRITE PROTECT",
  0x2707_u16 => "SPACE ALLOCATION FAILED WRITE PROTECT",
  0x2708_u16 => "ZONE IS READ ONLY",
  0x2800_u16 => "NOT READY TO READY CHANGE, MEDIUM MAY HAVE CHANGED",
  0x2801_u16 => "IMPORT OR EXPORT ELEMENT ACCESSED",
  0x2802_u16 => "FORMAT-LAYER MAY HAVE CHANGED",
  0x2803_u16 => "IMPORT/EXPORT ELEMENT ACCESSED, MEDIUM CHANGED",
  0x2900_u16 => "POWER ON, RESET, OR BUS DEVICE RESET OCCURRED",
  0x2901_u16 => "POWER ON OCCURRED",
  0x2902_u16 => "SCSI BUS RESET OCCURRED",
  0x2903_u16 => "BUS DEVICE RESET FUNCTION OCCURRED",
  0x2904_u16 => "DEVICE INTERNAL RESET",
  0x2905_u16 => "TRANSCEIVER MODE CHANGED TO SINGLE-ENDED",
  0x2906_u16 => "TRANSCEIVER MODE CHANGED TO LVD",
  0x2907_u16 => "I_T NEXUS LOSS OCCURRED",
  0x2A00_u16 => "PARAMETERS CHANGED",
  0x2A01_u16 => "MODE PARAMETERS CHANGED",
  0x2A02_u16 => "LOG PARAMETERS CHANGED",
  0x2A03_u16 => "RESERVATIONS PREEMPTED",
  0x2A04_u16 => "RESERVATIONS RELEASED",
  0x2A05_u16 => "REGISTRATIONS PREEMPTED",
  0x2A06_u16 => "ASYMMETRIC ACCESS STATE CHANGED",
  0x2A07_u16 => "IMPLICIT ASYMMETRIC ACCESS STATE TRANSITION FAILED",
  0x2A08_u16 => "PRIORITY CHANGED",
  0x2A09_u16 => "CAPACITY DATA HAS CHANGED",
  0x2A0A_u16 => "ERROR HISTORY I_T NEXUS CLEARED",
  0x2A0B_u16 => "ERROR HISTORY SNAPSHOT RELEASED",
  0x2A0C_u16 => "ERROR RECOVERY ATTRIBUTES HAVE CHANGED",
  0x2A0D_u16 => "DATA ENCRYPTION CAPABILITIES CHANGED",
  0x2A10_u16 => "TIMESTAMP CHANGED",
  0x2A11_u16 => "DATA ENCRYPTION PARAMETERS CHANGED BY ANOTHER I_T NEXUS",
  0x2A12_u16 => "DATA ENCRYPTION PARAMETERS CHANGED BY VENDOR SPECIFIC EVENT",
  0x2A13_u16 => "DATA ENCRYPTION KEY INSTANCE COUNTER HAS CHANGED",
  0x2A14_u16 => "SA CREATION CAPABILITIES DATA HAS CHANGED",
  0x2A15_u16 => "MEDIUM REMOVAL PREVENTION PREEMPTED",
  0x2A16_u16 => "ZONE RESET WRITE POINTER RECOMMENDED",
  0x2B00_u16 => "COPY CANNOT EXECUTE SINCE HOST CANNOT DISCONNECT",
  0x2C00_u16 => "COMMAND SEQUENCE ERROR",
  0x2C01_u16 => "TOO MANY WINDOWS SPECIFIED",
  0x2C02_u16 => "INVALID COMBINATION OF WINDOWS SPECIFIED",
  0x2C03_u16 => "CURRENT PROGRAM AREA IS NOT EMPTY",
  0x2C04_u16 => "CURRENT PROGRAM AREA IS EMPTY",
  0x2C05_u16 => "ILLEGAL POWER CONDITION REQUEST",
  0x2C06_u16 => "PERSISTENT PREVENT CONFLICT",
  0x2C07_u16 => "PREVIOUS BUSY STATUS",
  0x2C08_u16 => "PREVIOUS TASK SET FULL STATUS",
  0x2C09_u16 => "PREVIOUS RESERVATION CONFLICT STATUS",
  0x2C0A_u16 => "PARTITION OR COLLECTION CONTAINS USER OBJECTS",
  0x2C0B_u16 => "NOT RESERVED",
  0x2C0C_u16 => "ORWRITE GENERATION DOES NOT MATCH",
  0x2C0D_u16 => "RESET WRITE POINTER NOT ALLOWED",
  0x2C0E_u16 => "ZONE IS OFFLINE",
  0x2C0F_u16 => "STREAM NOT OPEN",
  0x2C10_u16 => "UNWRITTEN DATA IN ZONE",
  0x2C11_u16 => "DESCRIPTOR FORMAT SENSE DATA REQUIRED",
  0x2C12_u16 => "ZONE IS INACTIVE",
  0x2C13_u16 => "WELL KNOWN LOGICAL UNIT ACCESS REQUIRED",
  0x2D00_u16 => "OVERWRITE ERROR ON UPDATE IN PLACE",
  0x2E00_u16 => "INSUFFICIENT TIME FOR OPERATION",
  0x2E01_u16 => "COMMAND TIMEOUT BEFORE PROCESSING",
  0x2E02_u16 => "COMMAND TIMEOUT DURING PROCESSING",
  0x2E03_u16 => "COMMAND TIMEOUT DURING PROCESSING DUE TO ERROR RECOVERY",
  0x2F00_u16 => "COMMANDS CLEARED BY ANOTHER INITIATOR",
  0x2F01_u16 => "COMMANDS CLEARED BY POWER LOSS NOTIFICATION",
  0x2F02_u16 => "COMMANDS CLEARED BY DEVICE SERVER",
  0x2F03_u16 => "SOME COMMANDS CLEARED BY QUEUING LAYER EVENT",
  0x3000_u16 => "INCOMPATIBLE MEDIUM INSTALLED",
  0x3001_u16 => "CANNOT READ MEDIUM - UNKNOWN FORMAT",
  0x3002_u16 => "CANNOT READ MEDIUM - INCOMPATIBLE FORMAT",
  0x3003_u16 => "CLEANING CARTRIDGE INSTALLED",
  0x3004_u16 => "CANNOT WRITE MEDIUM - UNKNOWN FORMAT",
  0x3005_u16 => "CANNOT WRITE MEDIUM - INCOMPATIBLE FORMAT",
  0x3006_u16 => "CANNOT FORMAT MEDIUM - INCOMPATIBLE MEDIUM",
  0x3007_u16 => "CLEANING FAILURE",
  0x3008_u16 => "CANNOT WRITE - APPLICATION CODE MISMATCH",
  0x3009_u16 => "CURRENT SESSION NOT FIXATED FOR APPEND",
  0x300A_u16 => "CLEANING REQUEST REJECTED",
  0x300C_u16 => "WORM MEDIUM - OVERWRITE ATTEMPTED",
  0x300D_u16 => "WORM MEDIUM - INTEGRITY CHECK",
  0x3010_u16 => "MEDIUM NOT FORMATTED",
  0x3011_u16 => "INCOMPATIBLE VOLUME TYPE",
  0x3012_u16 => "INCOMPATIBLE VOLUME QUALIFIER",
  0x3013_u16 => "CLEANING VOLUME EXPIRED",
  0x3100_u16 => "MEDIUM FORMAT CORRUPTED",
  0x3101_u16 => "FORMAT COMMAND FAILED",
  0x3102_u16 => "ZONED FORMATTING FAILED DUE TO SPARE LINKING",
  0x3103_u16 => "SANITIZE COMMAND FAILED",
  0x3104_u16 => "DEPOPULATION FAILED",
  0x3105_u16 => "DEPOPULATION RESTORATION FAILED",
  0x3200_u16 => "NO DEFECT SPARE LOCATION AVAILABLE",
  0x3201_u16 => "DEFECT LIST UPDATE FAILURE",
  0x3300_u16 => "TAPE LENGTH ERROR",
  0x3400_u16 => "ENCLOSURE FAILURE",
  0x3500_u16 => "ENCLOSURE SERVICES FAILURE",
  0x3501_u16 => "UNSUPPORTED ENCLOSURE FUNCTION",
  0x3502_u16 => "ENCLOSURE SERVICES UNAVAILABLE",
  0x3503_u16 => "ENCLOSURE SERVICES TRANSFER FAILURE",
  0x3504_u16 => "ENCLOSURE SERVICES TRANSFER REFUSED",
  0x3505_u16 => "ENCLOSURE SERVICES CHECKSUM ERROR",
  0x3600_u16 => "RIBBON, INK, OR TONER FAILURE",
  0x3700_u16 => "ROUNDED PARAMETER",
  0x3800_u16 => "EVENT STATUS NOTIFICATION",
  0x3802_u16 => "ESN - POWER MANAGEMENT CLASS EVENT",
  0x3804_u16 => "ESN - MEDIA CLASS EVENT",
  0x3806_u16 => "ESN - DEVICE BUSY CLASS EVENT",
  0x3807_u16 => "THIN PROVISIONING SOFT THRESHOLD REACHED",
  0x3808_u16 => "DEPOPULATION INTERRUPTED",
  0x3900_u16 => "SAVING PARAMETERS NOT SUPPORTED",
  0x3A00_u16 => "MEDIUM NOT PRESENT",
  0x3A01_u16 => "MEDIUM NOT PRESENT - TRAY CLOSED",
  0x3A02_u16 => "MEDIUM NOT PRESENT - TRAY OPEN",
  0x3A03_u16 => "MEDIUM NOT PRESENT - LOADABLE",
  0x3A04_u16 => "MEDIUM NOT PRESENT - MEDIUM AUXILIARY MEMORY ACCESSIBLE",
  0x3B00_u16 => "SEQUENTIAL POSITIONING ERROR",
  0x3B01_u16 => "TAPE POSITION ERROR AT BEGINNING-OF-MEDIUM",
  0x3B02_u16 => "TAPE POSITION ERROR AT END-OF-MEDIUM",
  0x3B03_u16 => "TAPE OR ELECTRONIC VERTICAL FORMS UNIT NOT READY",
  0x3B04_u16 => "SLEW FAILURE",
  0x3B05_u16 => "PAPER JAM",
  0x3B06_u16 => "FAILED TO SENSE TOP-OF-FORM",
  0x3B07_u16 => "FAILED TO SENSE BOTTOM-OF-FORM",
  0x3B08_u16 => "REPOSITION ERROR",
  0x3B09_u16 => "READ PAST END OF MEDIUM",
  0x3B0A_u16 => "READ PAST BEGINNING OF MEDIUM",
  0x3B0B_u16 => "POSITION PAST END OF MEDIUM",
  0x3B0C_u16 => "POSITION PAST BEGINNING OF MEDIUM",
  0x3B0D_u16 => "MEDIUM DESTINATION ELEMENT FULL",
  0x3B0E_u16 => "MEDIUM SOURCE ELEMENT EMPTY",
  0x3B0F_u16 => "END OF MEDIUM REACHED",
  0x3B11_u16 => "MEDIUM MAGAZINE NOT ACCESSIBLE",
  0x3B12_u16 => "MEDIUM MAGAZINE REMOVED",
  0x3B13_u16 => "MEDIUM MAGAZINE INSERTED",
  0x3B14_u16 => "MEDIUM MAGAZINE LOCKED",
  0x3B15_u16 => "MEDIUM MAGAZINE UNLOCKED",
  0x3B16_u16 => "MECHANICAL POSITIONING OR CHANGER ERROR",
  0x3B17_u16 => "READ PAST END OF USER OBJECT",
  0x3B18_u16 => "ELEMENT DISABLED",
  0x3B19_u16 => "ELEMENT ENABLED",
  0x3B1A_u16 => "DATA TRANSFER DEVICE REMOVED",
  0x3B1B_u16 => "DATA TRANSFER DEVICE INSERTED",
  0x3B1C_u16 => "TOO MANY LOGICAL OBJECTS ON PARTITION TO SUPPORT OPERATION",
  0x3B20_u16 => "ELEMENT STATIC INFORMATION CHANGED",
  0x3D00_u16 => "INVALID BITS IN IDENTIFY MESSAGE",
  0x3E00_u16 => "LOGICAL UNIT HAS NOT SELF-CONFIGURED YET",
  0x3E01_u16 => "LOGICAL UNIT FAILURE",
  0x3E02_u16 => "TIMEOUT ON LOGICAL UNIT",
  0x3E03_u16 => "LOGICAL UNIT FAILED SELF-TEST",
  0x3E04_u16 => "LOGICAL UNIT UNABLE TO UPDATE SELF-TEST LOG",
  0x3F00_u16 => "TARGET OPERATING CONDITIONS HAVE CHANGED",
  0x3F01_u16 => "MICROCODE HAS BEEN CHANGED",
  0x3F02_u16 => "CHANGED OPERATING DEFINITION",
  0x3F03_u16 => "INQUIRY DATA HAS CHANGED",
  0x3F04_u16 => "COMPONENT DEVICE ATTACHED",
  0x3F05_u16 => "DEVICE IDENTIFIER CHANGED",
  0x3F06_u16 => "REDUNDANCY GROUP CREATED OR MODIFIED",
  0x3F07_u16 => "REDUNDANCY GROUP DELETED",
  0x3F08_u16 => "SPARE CREATED OR MODIFIED",
  0x3F09_u16 => "SPARE DELETED",
  0x3F0A_u16 => "VOLUME SET CREATED OR MODIFIED",
  0x3F0B_u16 => "VOLUME SET DELETED",
  0x3F0C_u16 => "VOLUME SET DEASSIGNED",
  0x3F0D_u16 => "VOLUME SET REASSIGNED",
  0x3F0E_u16 => "REPORTED LUNS DATA HAS CHANGED",
  0x3F0F_u16 => "ECHO BUFFER OVERWRITTEN",
  0x3F10_u16 => "MEDIUM LOADABLE",
  0x3F11_u16 => "MEDIUM AUXILIARY MEMORY ACCESSIBLE",
  0x3F12_u16 => "iSCSI IP ADDRESS ADDED",
  0x3F13_u16 => "iSCSI IP ADDRESS REMOVED",
  0x3F14_u16 => "iSCSI IP ADDRESS CHANGED",
  0x3F15_u16 => "INSPECT REFERRALS SENSE DESCRIPTORS",
  0x3F16_u16 => "MICROCODE HAS BEEN CHANGED WITHOUT RESET",
  0x3F17_u16 => "ZONE TRANSITION TO FULL",
  0x3F18_u16 => "BIND COMPLETED",
  0x3F19_u16 => "BIND REDIRECTED",
  0x3F1A_u16 => "SUBSIDIARY BINDING CHANGED",
  0x4000_u16 => "RAM FAILURE (SHOULD USE 40 NN)",
  //0x40NN_u16 => "DIAGNOSTIC FAILURE ON COMPONENT NN (80h-FFh)",
  0x4100_u16 => "DATA PATH FAILURE (SHOULD USE 40 NN)",
  0x4200_u16 => "POWER-ON OR SELF-TEST FAILURE (SHOULD USE 40 NN)",
  0x4300_u16 => "MESSAGE ERROR",
  0x4400_u16 => "INTERNAL TARGET FAILURE",
  0x4401_u16 => "PERSISTENT RESERVATION INFORMATION LOST",
  0x4471_u16 => "ATA DEVICE FAILED SET FEATURES",
  0x4500_u16 => "SELECT OR RESELECT FAILURE",
  0x4600_u16 => "UNSUCCESSFUL SOFT RESET",
  0x4700_u16 => "SCSI PARITY ERROR",
  0x4701_u16 => "DATA PHASE CRC ERROR DETECTED",
  0x4702_u16 => "SCSI PARITY ERROR DETECTED DURING ST DATA PHASE",
  0x4703_u16 => "INFORMATION UNIT iuCRC ERROR DETECTED",
  0x4704_u16 => "ASYNCHRONOUS INFORMATION PROTECTION ERROR DETECTED",
  0x4705_u16 => "PROTOCOL SERVICE CRC ERROR",
  0x4706_u16 => "PHY TEST FUNCTION IN PROGRESS",
  0x477F_u16 => "SOME COMMANDS CLEARED BY ISCSI PROTOCOL EVENT",
  0x4800_u16 => "INITIATOR DETECTED ERROR MESSAGE RECEIVED",
  0x4900_u16 => "INVALID MESSAGE ERROR",
  0x4A00_u16 => "COMMAND PHASE ERROR",
  0x4B00_u16 => "DATA PHASE ERROR",
  0x4B01_u16 => "INVALID TARGET PORT TRANSFER TAG RECEIVED",
  0x4B02_u16 => "TOO MUCH WRITE DATA",
  0x4B03_u16 => "ACK/NAK TIMEOUT",
  0x4B04_u16 => "NAK RECEIVED",
  0x4B05_u16 => "DATA OFFSET ERROR",
  0x4B06_u16 => "INITIATOR RESPONSE TIMEOUT",
  0x4B07_u16 => "CONNECTION LOST",
  0x4B08_u16 => "DATA-IN BUFFER OVERFLOW - DATA BUFFER SIZE",
  0x4B09_u16 => "DATA-IN BUFFER OVERFLOW - DATA BUFFER DESCRIPTOR AREA",
  0x4B0A_u16 => "DATA-IN BUFFER ERROR",
  0x4B0B_u16 => "DATA-OUT BUFFER OVERFLOW - DATA BUFFER SIZE",
  0x4B0C_u16 => "DATA-OUT BUFFER OVERFLOW - DATA BUFFER DESCRIPTOR AREA",
  0x4B0D_u16 => "DATA-OUT BUFFER ERROR",
  0x4B0E_u16 => "PCIE FABRIC ERROR",
  0x4B0F_u16 => "PCIE COMPLETION TIMEOUT",
  0x4B10_u16 => "PCIE COMPLETER ABORT",
  0x4B11_u16 => "PCIE POISONED TLP RECEIVED",
  0x4B12_u16 => "PCIE ECRC CHECK FAILED",
  0x4B13_u16 => "PCIE UNSUPPORTED REQUEST",
  0x4B14_u16 => "PCIE ACS VIOLATION",
  0x4B15_u16 => "PCIE TLP PREFIX BLOCKED",
  0x4C00_u16 => "LOGICAL UNIT FAILED SELF-CONFIGURATION",
  //0x4DNN_u16 => "TAGGED OVERLAPPED COMMANDS (NN = TASK TAG)",
  0x4E00_u16 => "OVERLAPPED COMMANDS ATTEMPTED",
  0x5000_u16 => "WRITE APPEND ERROR",
  0x5001_u16 => "WRITE APPEND POSITION ERROR",
  0x5002_u16 => "POSITION ERROR RELATED TO TIMING",
  0x5100_u16 => "ERASE FAILURE",
  0x5101_u16 => "ERASE FAILURE - INCOMPLETE ERASE OPERATION DETECTED",
  0x5200_u16 => "CARTRIDGE FAULT",
  0x5300_u16 => "MEDIA LOAD OR EJECT FAILED",
  0x5301_u16 => "UNLOAD TAPE FAILURE",
  0x5302_u16 => "MEDIUM REMOVAL PREVENTED",
  0x5303_u16 => "MEDIUM REMOVAL PREVENTED BY DATA TRANSFER ELEMENT",
  0x5304_u16 => "MEDIUM THREAD OR UNTHREAD FAILURE",
  0x5305_u16 => "VOLUME IDENTIFIER INVALID",
  0x5306_u16 => "VOLUME IDENTIFIER MISSING",
  0x5307_u16 => "DUPLICATE VOLUME IDENTIFIER",
  0x5308_u16 => "ELEMENT STATUS UNKNOWN",
  0x5309_u16 => "DATA TRANSFER DEVICE ERROR - LOAD FAILED",
  0x530A_u16 => "DATA TRANSFER DEVICE ERROR - UNLOAD FAILED",
  0x530B_u16 => "DATA TRANSFER DEVICE ERROR - UNLOAD MISSING",
  0x530C_u16 => "DATA TRANSFER DEVICE ERROR - EJECT FAILED",
  0x530D_u16 => "DATA TRANSFER DEVICE ERROR - LIBRARY COMMUNICATION FAILED",
  0x5400_u16 => "SCSI TO HOST SYSTEM INTERFACE FAILURE",
  0x5500_u16 => "SYSTEM RESOURCE FAILURE",
  0x5501_u16 => "SYSTEM BUFFER FULL",
  0x5502_u16 => "INSUFFICIENT RESERVATION RESOURCES",
  0x5503_u16 => "INSUFFICIENT RESOURCES",
  0x5504_u16 => "INSUFFICIENT REGISTRATION RESOURCES",
  0x5505_u16 => "INSUFFICIENT ACCESS CONTROL RESOURCES",
  0x5506_u16 => "AUXILIARY MEMORY OUT OF SPACE",
  0x5507_u16 => "QUOTA ERROR",
  0x5508_u16 => "MAXIMUM NUMBER OF SUPPLEMENTAL DECRYPTION KEYS EXCEEDED",
  0x5509_u16 => "MEDIUM AUXILIARY MEMORY NOT ACCESSIBLE",
  0x550A_u16 => "DATA CURRENTLY UNAVAILABLE",
  0x550B_u16 => "INSUFFICIENT POWER FOR OPERATION",
  0x550C_u16 => "INSUFFICIENT RESOURCES TO CREATE ROD",
  0x550D_u16 => "INSUFFICIENT RESOURCES TO CREATE ROD TOKEN",
  0x550E_u16 => "INSUFFICIENT ZONE RESOURCES",
  0x550F_u16 => "INSUFFICIENT ZONE RESOURCES TO COMPLETE WRITE",
  0x5510_u16 => "MAXIMUM NUMBER OF STREAMS OPEN",
  0x5511_u16 => "INSUFFICIENT RESOURCES TO BIND",
  0x5700_u16 => "UNABLE TO RECOVER TABLE-OF-CONTENTS",
  0x5800_u16 => "GENERATION DOES NOT EXIST",
  0x5900_u16 => "UPDATED BLOCK READ",
  0x5A00_u16 => "OPERATOR REQUEST OR STATE CHANGE INPUT",
  0x5A01_u16 => "OPERATOR MEDIUM REMOVAL REQUEST",
  0x5A02_u16 => "OPERATOR SELECTED WRITE PROTECT",
  0x5A03_u16 => "OPERATOR SELECTED WRITE PERMIT",
  0x5B00_u16 => "LOG EXCEPTION",
  0x5B01_u16 => "THRESHOLD CONDITION MET",
  0x5B02_u16 => "LOG COUNTER AT MAXIMUM",
  0x5B03_u16 => "LOG LIST CODES EXHAUSTED",
  0x5C00_u16 => "RPL STATUS CHANGE",
  0x5C01_u16 => "SPINDLES SYNCHRONIZED",
  0x5C02_u16 => "SPINDLES NOT SYNCHRONIZED",
  0x5D00_u16 => "FAILURE PREDICTION THRESHOLD EXCEEDED",
  0x5D01_u16 => "MEDIA FAILURE PREDICTION THRESHOLD EXCEEDED",
  0x5D02_u16 => "LOGICAL UNIT FAILURE PREDICTION THRESHOLD EXCEEDED",
  0x5D03_u16 => "SPARE AREA EXHAUSTION PREDICTION THRESHOLD EXCEEDED",
  0x5D10_u16 => "HARDWARE IMPENDING FAILURE GENERAL HARD DRIVE FAILURE",
  0x5D11_u16 => "HARDWARE IMPENDING FAILURE DRIVE ERROR RATE TOO HIGH",
  0x5D12_u16 => "HARDWARE IMPENDING FAILURE DATA ERROR RATE TOO HIGH",
  0x5D13_u16 => "HARDWARE IMPENDING FAILURE SEEK ERROR RATE TOO HIGH",
  0x5D14_u16 => "HARDWARE IMPENDING FAILURE TOO MANY BLOCK REASSIGNS",
  0x5D15_u16 => "HARDWARE IMPENDING FAILURE ACCESS TIMES TOO HIGH",
  0x5D16_u16 => "HARDWARE IMPENDING FAILURE START UNIT TIMES TOO HIGH",
  0x5D17_u16 => "HARDWARE IMPENDING FAILURE CHANNEL PARAMETRICS",
  0x5D18_u16 => "HARDWARE IMPENDING FAILURE CONTROLLER DETECTED",
  0x5D19_u16 => "HARDWARE IMPENDING FAILURE THROUGHPUT PERFORMANCE",
  0x5D1A_u16 => "HARDWARE IMPENDING FAILURE SEEK TIME PERFORMANCE",
  0x5D1B_u16 => "HARDWARE IMPENDING FAILURE SPIN-UP RETRY COUNT",
  0x5D1C_u16 => "HARDWARE IMPENDING FAILURE DRIVE CALIBRATION RETRY COUNT",
  0x5D1D_u16 => "HARDWARE IMPENDING FAILURE POWER LOSS PROTECTION CIRCUIT",
  0x5D20_u16 => "CONTROLLER IMPENDING FAILURE GENERAL HARD DRIVE FAILURE",
  0x5D21_u16 => "CONTROLLER IMPENDING FAILURE DRIVE ERROR RATE TOO HIGH",
  0x5D22_u16 => "CONTROLLER IMPENDING FAILURE DATA ERROR RATE TOO HIGH",
  0x5D23_u16 => "CONTROLLER IMPENDING FAILURE SEEK ERROR RATE TOO HIGH",
  0x5D24_u16 => "CONTROLLER IMPENDING FAILURE TOO MANY BLOCK REASSIGNS",
  0x5D25_u16 => "CONTROLLER IMPENDING FAILURE ACCESS TIMES TOO HIGH",
  0x5D26_u16 => "CONTROLLER IMPENDING FAILURE START UNIT TIMES TOO HIGH",
  0x5D27_u16 => "CONTROLLER IMPENDING FAILURE CHANNEL PARAMETRICS",
  0x5D28_u16 => "CONTROLLER IMPENDING FAILURE CONTROLLER DETECTED",
  0x5D29_u16 => "CONTROLLER IMPENDING FAILURE THROUGHPUT PERFORMANCE",
  0x5D2A_u16 => "CONTROLLER IMPENDING FAILURE SEEK TIME PERFORMANCE",
  0x5D2B_u16 => "CONTROLLER IMPENDING FAILURE SPIN-UP RETRY COUNT",
  0x5D2C_u16 => "CONTROLLER IMPENDING FAILURE DRIVE CALIBRATION RETRY COUNT",
  0x5D30_u16 => "DATA CHANNEL IMPENDING FAILURE GENERAL HARD DRIVE FAILURE",
  0x5D31_u16 => "DATA CHANNEL IMPENDING FAILURE DRIVE ERROR RATE TOO HIGH",
  0x5D32_u16 => "DATA CHANNEL IMPENDING FAILURE DATA ERROR RATE TOO HIGH",
  0x5D33_u16 => "DATA CHANNEL IMPENDING FAILURE SEEK ERROR RATE TOO HIGH",
  0x5D34_u16 => "DATA CHANNEL IMPENDING FAILURE TOO MANY BLOCK REASSIGNS",
  0x5D35_u16 => "DATA CHANNEL IMPENDING FAILURE ACCESS TIMES TOO HIGH",
  0x5D36_u16 => "DATA CHANNEL IMPENDING FAILURE START UNIT TIMES TOO HIGH",
  0x5D37_u16 => "DATA CHANNEL IMPENDING FAILURE CHANNEL PARAMETRICS",
  0x5D38_u16 => "DATA CHANNEL IMPENDING FAILURE CONTROLLER DETECTED",
  0x5D39_u16 => "DATA CHANNEL IMPENDING FAILURE THROUGHPUT PERFORMANCE",
  0x5D3A_u16 => "DATA CHANNEL IMPENDING FAILURE SEEK TIME PERFORMANCE",
  0x5D3B_u16 => "DATA CHANNEL IMPENDING FAILURE SPIN-UP RETRY COUNT",
  0x5D3C_u16 => "DATA CHANNEL IMPENDING FAILURE DRIVE CALIBRATION RETRY COUNT",
  0x5D40_u16 => "SERVO IMPENDING FAILURE GENERAL HARD DRIVE FAILURE",
  0x5D41_u16 => "SERVO IMPENDING FAILURE DRIVE ERROR RATE TOO HIGH",
  0x5D42_u16 => "SERVO IMPENDING FAILURE DATA ERROR RATE TOO HIGH",
  0x5D43_u16 => "SERVO IMPENDING FAILURE SEEK ERROR RATE TOO HIGH",
  0x5D44_u16 => "SERVO IMPENDING FAILURE TOO MANY BLOCK REASSIGNS",
  0x5D45_u16 => "SERVO IMPENDING FAILURE ACCESS TIMES TOO HIGH",
  0x5D46_u16 => "SERVO IMPENDING FAILURE START UNIT TIMES TOO HIGH",
  0x5D47_u16 => "SERVO IMPENDING FAILURE CHANNEL PARAMETRICS",
  0x5D48_u16 => "SERVO IMPENDING FAILURE CONTROLLER DETECTED",
  0x5D49_u16 => "SERVO IMPENDING FAILURE THROUGHPUT PERFORMANCE",
  0x5D4A_u16 => "SERVO IMPENDING FAILURE SEEK TIME PERFORMANCE",
  0x5D4B_u16 => "SERVO IMPENDING FAILURE SPIN-UP RETRY COUNT",
  0x5D4C_u16 => "SERVO IMPENDING FAILURE DRIVE CALIBRATION RETRY COUNT",
  0x5D50_u16 => "SPINDLE IMPENDING FAILURE GENERAL HARD DRIVE FAILURE",
  0x5D51_u16 => "SPINDLE IMPENDING FAILURE DRIVE ERROR RATE TOO HIGH",
  0x5D52_u16 => "SPINDLE IMPENDING FAILURE DATA ERROR RATE TOO HIGH",
  0x5D53_u16 => "SPINDLE IMPENDING FAILURE SEEK ERROR RATE TOO HIGH",
  0x5D54_u16 => "SPINDLE IMPENDING FAILURE TOO MANY BLOCK REASSIGNS",
  0x5D55_u16 => "SPINDLE IMPENDING FAILURE ACCESS TIMES TOO HIGH",
  0x5D56_u16 => "SPINDLE IMPENDING FAILURE START UNIT TIMES TOO HIGH",
  0x5D57_u16 => "SPINDLE IMPENDING FAILURE CHANNEL PARAMETRICS",
  0x5D58_u16 => "SPINDLE IMPENDING FAILURE CONTROLLER DETECTED",
  0x5D59_u16 => "SPINDLE IMPENDING FAILURE THROUGHPUT PERFORMANCE",
  0x5D5A_u16 => "SPINDLE IMPENDING FAILURE SEEK TIME PERFORMANCE",
  0x5D5B_u16 => "SPINDLE IMPENDING FAILURE SPIN-UP RETRY COUNT",
  0x5D5C_u16 => "SPINDLE IMPENDING FAILURE DRIVE CALIBRATION RETRY COUNT",
  0x5D60_u16 => "FIRMWARE IMPENDING FAILURE GENERAL HARD DRIVE FAILURE",
  0x5D61_u16 => "FIRMWARE IMPENDING FAILURE DRIVE ERROR RATE TOO HIGH",
  0x5D62_u16 => "FIRMWARE IMPENDING FAILURE DATA ERROR RATE TOO HIGH",
  0x5D63_u16 => "FIRMWARE IMPENDING FAILURE SEEK ERROR RATE TOO HIGH",
  0x5D64_u16 => "FIRMWARE IMPENDING FAILURE TOO MANY BLOCK REASSIGNS",
  0x5D65_u16 => "FIRMWARE IMPENDING FAILURE ACCESS TIMES TOO HIGH",
  0x5D66_u16 => "FIRMWARE IMPENDING FAILURE START UNIT TIMES TOO HIGH",
  0x5D67_u16 => "FIRMWARE IMPENDING FAILURE CHANNEL PARAMETRICS",
  0x5D68_u16 => "FIRMWARE IMPENDING FAILURE CONTROLLER DETECTED",
  0x5D69_u16 => "FIRMWARE IMPENDING FAILURE THROUGHPUT PERFORMANCE",
  0x5D6A_u16 => "FIRMWARE IMPENDING FAILURE SEEK TIME PERFORMANCE",
  0x5D6B_u16 => "FIRMWARE IMPENDING FAILURE SPIN-UP RETRY COUNT",
  0x5D6C_u16 => "FIRMWARE IMPENDING FAILURE DRIVE CALIBRATION RETRY COUNT",
  0x5D73_u16 => "MEDIA IMPENDING FAILURE ENDURANCE LIMIT MET",
  0x5DFF_u16 => "FAILURE PREDICTION THRESHOLD EXCEEDED (FALSE)",
  0x5E00_u16 => "LOW POWER CONDITION ON",
  0x5E01_u16 => "IDLE CONDITION ACTIVATED BY TIMER",
  0x5E02_u16 => "STANDBY CONDITION ACTIVATED BY TIMER",
  0x5E03_u16 => "IDLE CONDITION ACTIVATED BY COMMAND",
  0x5E04_u16 => "STANDBY CONDITION ACTIVATED BY COMMAND",
  0x5E05_u16 => "IDLE_B CONDITION ACTIVATED BY TIMER",
  0x5E06_u16 => "IDLE_B CONDITION ACTIVATED BY COMMAND",
  0x5E07_u16 => "IDLE_C CONDITION ACTIVATED BY TIMER",
  0x5E08_u16 => "IDLE_C CONDITION ACTIVATED BY COMMAND",
  0x5E09_u16 => "STANDBY_Y CONDITION ACTIVATED BY TIMER",
  0x5E0A_u16 => "STANDBY_Y CONDITION ACTIVATED BY COMMAND",
  0x5E41_u16 => "POWER STATE CHANGE TO ACTIVE",
  0x5E42_u16 => "POWER STATE CHANGE TO IDLE",
  0x5E43_u16 => "POWER STATE CHANGE TO STANDBY",
  0x5E45_u16 => "POWER STATE CHANGE TO SLEEP",
  0x5E47_u16 => "POWER STATE CHANGE TO DEVICE CONTROL",
  0x6000_u16 => "LAMP FAILURE",
  0x6100_u16 => "VIDEO ACQUISITION ERROR",
  0x6101_u16 => "UNABLE TO ACQUIRE VIDEO",
  0x6102_u16 => "OUT OF FOCUS",
  0x6200_u16 => "SCAN HEAD POSITIONING ERROR",
  0x6300_u16 => "END OF USER AREA ENCOUNTERED ON THIS TRACK",
  0x6301_u16 => "PACKET DOES NOT FIT IN AVAILABLE SPACE",
  0x6400_u16 => "ILLEGAL MODE FOR THIS TRACK",
  0x6401_u16 => "INVALID PACKET SIZE",
  0x6500_u16 => "VOLTAGE FAULT",
  0x6600_u16 => "AUTOMATIC DOCUMENT FEEDER COVER UP",
  0x6601_u16 => "AUTOMATIC DOCUMENT FEEDER LIFT UP",
  0x6602_u16 => "DOCUMENT JAM IN AUTOMATIC DOCUMENT FEEDER",
  0x6603_u16 => "DOCUMENT MISS FEED AUTOMATIC IN DOCUMENT FEEDER",
  0x6700_u16 => "CONFIGURATION FAILURE",
  0x6701_u16 => "CONFIGURATION OF INCAPABLE LOGICAL UNITS FAILED",
  0x6702_u16 => "ADD LOGICAL UNIT FAILED",
  0x6703_u16 => "MODIFICATION OF LOGICAL UNIT FAILED",
  0x6704_u16 => "EXCHANGE OF LOGICAL UNIT FAILED",
  0x6705_u16 => "REMOVE OF LOGICAL UNIT FAILED",
  0x6706_u16 => "ATTACHMENT OF LOGICAL UNIT FAILED",
  0x6707_u16 => "CREATION OF LOGICAL UNIT FAILED",
  0x6708_u16 => "ASSIGN FAILURE OCCURRED",
  0x6709_u16 => "MULTIPLY ASSIGNED LOGICAL UNIT",
  0x670A_u16 => "SET TARGET PORT GROUPS COMMAND FAILED",
  0x670B_u16 => "ATA DEVICE FEATURE NOT ENABLED",
  0x670C_u16 => "COMMAND REJECTED",
  0x670D_u16 => "EXPLICIT BIND NOT ALLOWED",
  0x6800_u16 => "LOGICAL UNIT NOT CONFIGURED",
  0x6801_u16 => "SUBSIDIARY LOGICAL UNIT NOT CONFIGURED",
  0x6900_u16 => "DATA LOSS ON LOGICAL UNIT",
  0x6901_u16 => "MULTIPLE LOGICAL UNIT FAILURES",
  0x6902_u16 => "PARITY/DATA MISMATCH",
  0x6A00_u16 => "INFORMATIONAL, REFER TO LOG",
  0x6B00_u16 => "STATE CHANGE HAS OCCURRED",
  0x6B01_u16 => "REDUNDANCY LEVEL GOT BETTER",
  0x6B02_u16 => "REDUNDANCY LEVEL GOT WORSE",
  0x6C00_u16 => "REBUILD FAILURE OCCURRED",
  0x6D00_u16 => "RECALCULATE FAILURE OCCURRED",
  0x6E00_u16 => "COMMAND TO LOGICAL UNIT FAILED",
  0x6F00_u16 => "COPY PROTECTION KEY EXCHANGE FAILURE - AUTHENTICATION FAILURE",
  0x6F01_u16 => "COPY PROTECTION KEY EXCHANGE FAILURE - KEY NOT PRESENT",
  0x6F02_u16 => "COPY PROTECTION KEY EXCHANGE FAILURE - KEY NOT ESTABLISHED",
  0x6F03_u16 => "READ OF SCRAMBLED SECTOR WITHOUT AUTHENTICATION",
  0x6F04_u16 => "MEDIA REGION CODE IS MISMATCHED TO LOGICAL UNIT REGION",
  0x6F05_u16 => "DRIVE REGION MUST BE PERMANENT/REGION RESET COUNT ERROR",
  0x6F06_u16 => "INSUFFICIENT BLOCK COUNT FOR BINDING NONCE RECORDING",
  0x6F07_u16 => "CONFLICT IN BINDING NONCE RECORDING",
  0x6F08_u16 => "INSUFFICIENT PERMISSION",
  0x6F09_u16 => "INVALID DRIVE-HOST PAIRING SERVER",
  0x6F0A_u16 => "DRIVE-HOST PAIRING SUSPENDED",
  //0x70NN_u16 => "DECOMPRESSION EXCEPTION SHORT ALGORITHM ID OF NN",
  0x7100_u16 => "DECOMPRESSION EXCEPTION LONG ALGORITHM ID",
  0x7200_u16 => "SESSION FIXATION ERROR",
  0x7201_u16 => "SESSION FIXATION ERROR WRITING LEAD-IN",
  0x7202_u16 => "SESSION FIXATION ERROR WRITING LEAD-OUT",
  0x7203_u16 => "SESSION FIXATION ERROR - INCOMPLETE TRACK IN SESSION",
  0x7204_u16 => "EMPTY OR PARTIALLY WRITTEN RESERVED TRACK",
  0x7205_u16 => "NO MORE TRACK RESERVATIONS ALLOWED",
  0x7206_u16 => "RMZ EXTENSION IS NOT ALLOWED",
  0x7207_u16 => "NO MORE TEST ZONE EXTENSIONS ARE ALLOWED",
  0x7300_u16 => "CD CONTROL ERROR",
  0x7301_u16 => "POWER CALIBRATION AREA ALMOST FULL",
  0x7302_u16 => "POWER CALIBRATION AREA IS FULL",
  0x7303_u16 => "POWER CALIBRATION AREA ERROR",
  0x7304_u16 => "PROGRAM MEMORY AREA UPDATE FAILURE",
  0x7305_u16 => "PROGRAM MEMORY AREA IS FULL",
  0x7306_u16 => "RMA/PMA IS ALMOST FULL",
  0x7310_u16 => "CURRENT POWER CALIBRATION AREA ALMOST FULL",
  0x7311_u16 => "CURRENT POWER CALIBRATION AREA IS FULL",
  0x7317_u16 => "RDZ IS FULL",
  0x7400_u16 => "SECURITY ERROR",
  0x7401_u16 => "UNABLE TO DECRYPT DATA",
  0x7402_u16 => "UNENCRYPTED DATA ENCOUNTERED WHILE DECRYPTING",
  0x7403_u16 => "INCORRECT DATA ENCRYPTION KEY",
  0x7404_u16 => "CRYPTOGRAPHIC INTEGRITY VALIDATION FAILED",
  0x7405_u16 => "ERROR DECRYPTING DATA",
  0x7406_u16 => "UNKNOWN SIGNATURE VERIFICATION KEY",
  0x7407_u16 => "ENCRYPTION PARAMETERS NOT USEABLE",
  0x7408_u16 => "DIGITAL SIGNATURE VALIDATION FAILURE",
  0x7409_u16 => "ENCRYPTION MODE MISMATCH ON READ",
  0x740A_u16 => "ENCRYPTED BLOCK NOT RAW READ ENABLED",
  0x740B_u16 => "INCORRECT ENCRYPTION PARAMETERS",
  0x740C_u16 => "UNABLE TO DECRYPT PARAMETER LIST",
  0x740D_u16 => "ENCRYPTION ALGORITHM DISABLED",
  0x7410_u16 => "SA CREATION PARAMETER VALUE INVALID",
  0x7411_u16 => "SA CREATION PARAMETER VALUE REJECTED",
  0x7412_u16 => "INVALID SA USAGE",
  0x7421_u16 => "DATA ENCRYPTION CONFIGURATION PREVENTED",
  0x7430_u16 => "SA CREATION PARAMETER NOT SUPPORTED",
  0x7440_u16 => "AUTHENTICATION FAILED",
  0x7461_u16 => "EXTERNAL DATA ENCRYPTION KEY MANAGER ACCESS ERROR",
  0x7462_u16 => "EXTERNAL DATA ENCRYPTION KEY MANAGER ERROR",
  0x7463_u16 => "EXTERNAL DATA ENCRYPTION KEY NOT FOUND",
  0x7464_u16 => "EXTERNAL DATA ENCRYPTION REQUEST NOT AUTHORIZED",
  0x746E_u16 => "EXTERNAL DATA ENCRYPTION CONTROL TIMEOUT",
  0x746F_u16 => "EXTERNAL DATA ENCRYPTION CONTROL ERROR",
  0x7471_u16 => "LOGICAL UNIT ACCESS NOT AUTHORIZED",
  0x7479_u16 => "SECURITY CONFLICT IN TRANSLATED DEVICE",
};

/// SPC-3 Section 4.5.6 Table 27
#[repr(C)]
#[derive(Debug)]
pub enum SenseKey {
  NoSense,
  RecoveredError,
  NotReady,
  MediumError,
  HardwareError,
  IllegalRequest,
  UnitAttention,
  DataProtect,
  BlankCheck,
  VendorSpecific,
  CopyAborted,
  AbortedCommand,
  VolumeOverflow,
  Miscompare,
  Unknown(u8),
}

impl Default for SenseKey {
  fn default() -> Self { SenseKey::NoSense }
}

impl SenseKey {
  fn from_u8(val: u8) -> SenseKey {
    match val {
      0x00 => { SenseKey::NoSense },
      0x01 => { SenseKey::RecoveredError },
      0x02 => { SenseKey::NotReady },
      0x03 => { SenseKey::MediumError },
      0x04 => { SenseKey::HardwareError },
      0x05 => { SenseKey::IllegalRequest },
      0x06 => { SenseKey::UnitAttention },
      0x07 => { SenseKey::DataProtect },
      0x08 => { SenseKey::BlankCheck },
      0x09 => { SenseKey::VendorSpecific },
      0x0A => { SenseKey::CopyAborted },
      0x0B => { SenseKey::AbortedCommand },
      0x0D => { SenseKey::VolumeOverflow },
      0x0E => { SenseKey::Miscompare },
      _ => { SenseKey::Unknown(val) },
    }
  }
}

/// SPC-3 Section 4.5.2.4.2
#[repr(C)]
#[derive(Default, Debug)]
pub struct SenseFieldPointer {
  pub c_d: bool,
  pub bpv: bool,
  pub bit_pointer: u8,
  pub field_pointer: u16,
}

impl SenseFieldPointer {
  fn from_buf(buf: &[u8]) -> Option <SenseFieldPointer> {
    if buf.len() < 3 {
      return None;
    }

    Some(SenseFieldPointer {
      c_d: buf[0] & 0x40 == 0x40,
      bpv: buf[0] & 0x08 == 0x08,
      bit_pointer: buf[0] & 0x07,
      field_pointer: u16::from_be_bytes(buf[1..3].try_into().unwrap()),
    })
  }
}

/// SPC-3 Section 4.5.2.4.3
#[repr(C)]
#[derive(Default, Debug)]
pub struct SenseActualRetryCount {
  pub actual_retry_count: u16,
}

impl SenseActualRetryCount {
  fn from_buf(buf: &[u8]) -> Option <SenseActualRetryCount> {
    if buf.len() < 3 {
      return None;
    }

    Some(SenseActualRetryCount {
      actual_retry_count: u16::from_be_bytes(buf[1..3].try_into().unwrap()),
    })
  }
}

/// SPC-3 Section 4.5.2.4.4
#[repr(C)]
#[derive(Default, Debug)]
pub struct SenseProgress {
  pub progress: u16,
}

impl SenseProgress {
  fn from_buf(buf: &[u8]) -> Option <SenseProgress> {
    if buf.len() < 3 {
      return None;
    }

    Some(SenseProgress {
      progress: u16::from_be_bytes(buf[1..3].try_into().unwrap()),
    })
  }
}

/// SPC-3 Section 4.5.2.4.5
#[repr(C)]
#[derive(Default, Debug)]
pub struct SenseSegmentPointer {
  pub sd: bool,
  pub bpv: bool,
  pub bit_pointer: u8,
  pub field_pointer: u16,
}

impl SenseSegmentPointer {
  fn from_buf(buf: &[u8]) -> Option <SenseSegmentPointer> {
    if buf.len() < 3 {
      return None;
    }

    Some(SenseSegmentPointer {
      sd: buf[0] & 0x20 == 0x20,
      bpv: buf[0] & 0x08 == 0x08,
      bit_pointer: buf[0] & 0x07,
      field_pointer: u16::from_be_bytes(buf[1..3].try_into().unwrap()),
    })
  }
}

/// SPC-3 Section 4.5.2.4
#[repr(C)]
#[derive(Debug)]
pub enum SenseKeySpecific {
  Nothing,
  IllegalRequest(SenseFieldPointer),
  Error(SenseActualRetryCount),
  NotReady(SenseProgress),
  CopyAborted(SenseSegmentPointer),
}

impl Default for SenseKeySpecific {
  fn default() -> Self { SenseKeySpecific::Nothing }
}

impl SenseKeySpecific {
  pub fn from_buf(key: &SenseKey, buf: &[u8]) -> SenseKeySpecific {
    if buf.len() < 3 {
      return SenseKeySpecific::Nothing;
    }

    match key {
      SenseKey::IllegalRequest => {
        if let Some(tmp) = SenseFieldPointer::from_buf(&buf) {
          return SenseKeySpecific::IllegalRequest(tmp);
        }
      },
      SenseKey::HardwareError |
      SenseKey::MediumError |
      SenseKey::RecoveredError => {
        if let Some(tmp) = SenseActualRetryCount::from_buf(&buf){
          return SenseKeySpecific::Error(tmp);
        }
      },
      SenseKey::NoSense |
      SenseKey::NotReady => {
        if let Some(tmp) = SenseProgress::from_buf(&buf) {
          return SenseKeySpecific::NotReady(tmp);
        }
      },
      SenseKey::CopyAborted => {
        if let Some(tmp) = SenseSegmentPointer::from_buf(&buf) {
          return SenseKeySpecific::CopyAborted(tmp);
        }
      },
      _ => { return SenseKeySpecific::Nothing; }
    }

    SenseKeySpecific::Nothing
  }
}

/// SPC-3 Section 4.5
#[derive(Default, Debug)]
pub struct Sense {
  pub deferred: bool,
  pub filemark: bool,
  pub eom: bool,
  pub ili: bool,
  pub sense_key: SenseKey,
  pub information: [u8; 8],
  pub command_specific_information: [u8; 8],
  pub additional_sense_code: u8,
  pub additional_sense_code_qualifier: u8,
  pub field_replaceable_unit_code: u8,
  pub vendor_specific_sense_data: Vec <u8>,
  pub sense_key_specific: SenseKeySpecific,
  pub additional_sense_bytes: Vec <u8>,
}

impl fmt::Display for Sense {
  fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
    let asc_ascq_key =
        (self.additional_sense_code as u16) << 8 | 
        self.additional_sense_code_qualifier as u16;

    let sense_code_msg = match asc_ascq_key {
      0x4080..=0x40FF_u16 => "DIAGNOSTIC FAILURE ON COMPONENT (Look at ASCQ)",
      0x4D00..=0x4DFF_u16 => "TAGGED OVERLAPPED COMMANDS (Look at ASCQ)",
      0x7000..=0x70FF_u16 => "DECOMPRESSION EXCEPTION SHORT ALGORITHM ID (Look at ASCQ)",
      _ => if let Some(msg) = ADDITIONAL_SENSE_CODE_STRINGS.get(&asc_ascq_key) {
        msg
      } else {
        "UNKNOWN"
      },
    };

    //TODO Finish printing all info
    write!(f, concat!(
        "Flags:{}{}{}{}\n",
        "ASC/ASCQ: {:#04x}/{:#04x} {}\n",
        "Sense Key: {:?}\n",
        "Sense Key Specific: {:?}\n",
        ),
        if self.deferred { " DEFERRED" } else { "" },
        if self.filemark { " FILEMARK" } else { "" },
        if self.eom { " EOM" } else { "" },
        if self.ili { " ILI" } else { "" },
        self.additional_sense_code, self.additional_sense_code_qualifier, sense_code_msg,
        self.sense_key,
        self.sense_key_specific,
    )
  }
}

impl Sense {
  /// Fixed format described in SPC-3 Section 4.5.3
  fn from_buf_fixed(buf: &[u8]) -> Option <Sense> {
    if buf.len() < 8 {
      return None;
    }

    let response_code = buf[0] & 0x7F;
    if !(0x70..=0x71_u8).contains(&response_code) {
      return None;
    }

    let mut rv: Sense = Sense {
      deferred: response_code == 0x71,
      filemark: buf[2] & 0x80 == 0x80,
      eom: buf[2] & 0x40 == 0x40,
      ili: buf[2] & 0x20 == 0x20,
      sense_key: SenseKey::from_u8(buf[2] & 0x0F),
      ..Default::default()
    };

    if buf[0] & 0x80 == 0x80 {
      rv.information[4..].copy_from_slice(&buf[3..7]);
    }

    let additional_sense_length = buf[7] as usize;

    if additional_sense_length < 4 {
      return Some(rv);
    }
    if let Some(slice) = buf.get(8..12) {
      rv.command_specific_information[4..].copy_from_slice(&slice);
    }

    if additional_sense_length < 5 {
      return Some(rv);
    }
    if let Some(val) = buf.get(12) {
      rv.additional_sense_code = *val; 
    }

    if additional_sense_length < 6 {
      return Some(rv);
    }
    if let Some(val) = buf.get(13) {
      rv.additional_sense_code_qualifier = *val; 
    }

    if additional_sense_length < 7 {
      return Some(rv);
    }
    if let Some(val) = buf.get(14) {
      rv.field_replaceable_unit_code = *val; 
    }

    if additional_sense_length < 10 {
      return Some(rv);
    }
    if let Some(slice) = buf.get(15..18) {
      if slice[0] & 0x80 == 0x80 {
        rv.sense_key_specific = SenseKeySpecific::from_buf(&rv.sense_key, &slice);
      }
    }

    let end = additional_sense_length + 8;
    if let Some(slice) = buf.get(18..end) {
      rv.additional_sense_bytes = slice.to_vec();
    }

    Some(rv)
  }

  /// Descriptor format described in SPC-3 Section 4.5.2
  fn from_buf_descriptor(buf: &[u8]) -> Option <Sense> {
    if buf.len() < 8 {
      return None;
    }

    let response_code = buf[0] & 0x7F;
    if !(0x72..=0x73_u8).contains(&response_code) {
      return None;
    }

    let mut rv: Sense = Sense {
      deferred: response_code == 0x73,
      sense_key: SenseKey::from_u8(buf[1] & 0x0F),
      additional_sense_code: buf[2],
      additional_sense_code_qualifier: buf[3],
      ..Default::default()
    };

    let additional_sense_length = buf[7] as usize;
    let mut index: usize = 8;
    while let Some(dtype) = buf.get(index) {
      if index - 8 >= additional_sense_length {
        break;
      }

      // Matching keys are based on SPC-3 Table 15
      match dtype {
        0x00 => {
          if let Some(info) = buf.get(index..(index + 12)) {
            rv.information.copy_from_slice(&info[4..12]);
          }
          index += 12;
        },
        0x01 => {
          if let Some(cmd_info) = buf.get(index..(index + 12)) {
            rv.command_specific_information.copy_from_slice(&cmd_info[4..12]);
          }
          index += 12;
        },
        0x02 => {
          if let Some(skp) = buf.get(index..(index + 8)) {
            rv.sense_key_specific = SenseKeySpecific::from_buf(&rv.sense_key, &skp[4..7]);
          }
          index += 8;
        },
        0x03 => {
          if let Some(fru) = buf.get(index..(index + 4)) {
            rv.field_replaceable_unit_code = fru[3];
          }
          index += 4;
        },
        0x04 => {
          //TODO For now, just stop parsing the buffer
          break;
        },
        0x05 => {
          break;
        },
        0x06 => {
          break;
        },
        0x07 => {
          break;
        },
        0x08 => {
          break;
        },
        0x09 => {
          break;
        },
        0x80..=0xFF => {
          if let Some(vend) = buf.get(index..(index + 2)) {
            if let Some(spec) = buf.get((index + 2)..(index + 2 + (vend[1] as usize))) {
              rv.vendor_specific_sense_data = spec.to_vec();
            }
            index += vend[1] as usize;
          }
          index += 2;
        },
        _ => {
          //TODO If it's unknown, what do we do? Append it as additional_sense_bytes? Have an unknown vec?
          break;
        }
      }
    }

    Some(rv)
  }


  pub fn from_buf(buf: &[u8]) -> Option <Sense> {
    if let Some(rv) = Sense::from_buf_descriptor(buf) {
      return Some(rv);
    }

    Sense::from_buf_fixed(buf)
  }
}


// C Functions

#[no_mangle]
pub extern fn sense_to_stdout(sense: *const Sense) {
  let sense = unsafe { &*sense };
  println!("{}", sense);
}
